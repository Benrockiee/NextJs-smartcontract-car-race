(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[423],{1482:function(a,b,c){"use strict";c.d(b,{v:function(){return g}});var d=c(45624),e=c(37202),f=c.n(e);class g extends d.J5{async authenticateUser(){var a;if(!this.provider||!(null!==(a=this.chainConfig)&& void 0!==a&&a.chainId))throw d.RM.notConnectedError();let{chainNamespace:b,chainId:c}=this.chainConfig;if(this.status!==d.MP.CONNECTED)throw d.RM.notConnectedError("Not connected with wallet, Please login/connect first");let e=await this.provider.request({method:"getAccounts"});if(e&&e.length>0){let g=(0,d.Cb)(e[0],this.name);if(g){let h=(0,d.$E)(g);if(!h)return{idToken:g}}let i={domain:window.location.origin,uri:window.location.href,address:e[0],chainId:parseInt(c,16),version:"1",nonce:Math.random().toString(36).slice(2),issuedAt:new Date().toISOString()},j=await (0,d.tV)(i,b),k=new TextEncoder().encode(j),l=await this.provider.request({method:"signMessage",params:{message:k,display:"utf8"}}),m=await (0,d.rn)(b,f().encode(l),j,this.name,this.sessionTime);return(0,d.Fr)(e[0],this.name,m),{idToken:m}}throw d.RM.notConnectedError("Not connected with wallet, Please login/connect first")}async disconnect(){if(this.status!==d.MP.CONNECTED)throw d.RM.disconnectionError("Not connected with wallet");let a=await this.provider.request({method:"getAccounts"});a&&a.length>0&&(0,d.qz)(a[0],this.name)}}},55777:function(a){"use strict";a.exports=function(a){if(a.length>=255)throw TypeError("Alphabet too long");for(var b=new Uint8Array(256),c=0;c<b.length;c++)b[c]=255;for(var d=0;d<a.length;d++){var e=a.charAt(d),f=e.charCodeAt(0);if(255!==b[f])throw TypeError(e+" is ambiguous");b[f]=d}var g=a.length,h=a.charAt(0),i=Math.log(g)/Math.log(256),j=Math.log(256)/Math.log(g);function k(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;for(var c=0,d=0,e=0;a[c]===h;)d++,c++;for(var f=(a.length-c)*i+1>>>0,j=new Uint8Array(f);a[c];){var k=b[a.charCodeAt(c)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&& -1!==m;m--,l++)k+=g*j[m]>>>0,j[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,c++}for(var n=f-e;n!==f&&0===j[n];)n++;for(var o=new Uint8Array(d+(f-n)),p=d;n!==f;)o[p++]=j[n++];return o}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var i=(f-e)*j+1>>>0,k=new Uint8Array(i);e!==f;){for(var l=b[e],m=0,n=i-1;(0!==l||m<d)&& -1!==n;n--,m++)l+=256*k[n]>>>0,k[n]=l%g>>>0,l=l/g>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var o=i-d;o!==i&&0===k[o];)o++;for(var p=h.repeat(c);o<i;++o)p+=a.charAt(k[o]);return p},decodeUnsafe:k,decode:function(a){var b=k(a);if(b)return b;throw Error("Non-base"+g+" character")}}}},37202:function(a,b,c){let d=c(55777);a.exports=d("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},94423:function(a,b,c){"use strict";c.r(b),c.d(b,{SolanaWalletAdapter:function(){return aa}});var d=c(4942),e=c(59917),f=c(22782),g=c(20917),h=c(95844),i=c(79826),j=c(24970),k=c(74286),l=c.n(k),m=c(2043),n=c.n(m),o=c(64063),p=c.n(o),q=c(48764).Buffer,r={errors:{disconnected:()=>"Torus: Lost connection to Torus.",permanentlyDisconnected:()=>"Torus: Disconnected from iframe. Page reload required.",unsupportedSync:a=>"Torus: The Torus Ethereum provider does not support synchronous methods like ".concat(a," without a callback parameter."),invalidDuplexStream:()=>"Must provide a Node.js-style duplex stream.",invalidOptions:a=>"Invalid options. Received: { maxEventListeners: ".concat(a,"}"),invalidRequestArgs:()=>"Expected a single, non-array, object argument.",invalidRequestMethod:()=>"'args.method' must be a non-empty string.",invalidRequestParams:()=>"'args.params' must be an object or array if provided.",invalidLoggerObject:()=>"'args.logger' must be an object if provided.",invalidLoggerMethod:a=>"'args.logger' must include required method '".concat(a,"'.")},info:{connected:a=>'Torus: Connected to chain with ID "'.concat(a,'".')},warnings:{}};let s={PRODUCTION:"production",DEVELOPMENT:"development",TESTING:"testing"},t={BOTTOM_LEFT:"bottom-left",TOP_LEFT:"top-left",BOTTOM_RIGHT:"bottom-right",TOP_RIGHT:"top-right"},u={GOOGLE:"google",FACEBOOK:"facebook",REDDIT:"reddit",DISCORD:"discord",TWITCH:"twitch",APPLE:"apple",LINE:"line",GITHUB:"github",KAKAO:"kakao",LINKEDIN:"linkedin",TWITTER:"twitter",WEIBO:"weibo",WECHAT:"wechat",EMAIL_PASSWORDLESS:"email_passwordless"};var v={supportedVerifierList:[u.GOOGLE,u.REDDIT,u.DISCORD],api:"https://api.tor.us",translations:{en:{embed:{continue:"Continue",actionRequired:"Authorization required",pendingAction:"Click continue to proceed with your request in a popup",cookiesRequired:"Cookies Required",enableCookies:"Please enable cookies in your browser preferences to access Torus",clickHere:"More Info"}},de:{embed:{continue:"Fortsetzen",actionRequired:"Autorisierung erforderlich",pendingAction:"Klicken Sie in einem Popup auf Weiter, um mit Ihrer Anfrage fortzufahren",cookiesRequired:"Cookies ben\xf6tigt",enableCookies:"Bitte aktivieren Sie Cookies in Ihren Browsereinstellungen, um auf Torus zuzugreifen",clickHere:"Mehr Info"}},ja:{embed:{continue:"継続する",actionRequired:"認証が必要です",pendingAction:"続行をクリックして、ポップアップでリクエストを続行します",cookiesRequired:"必要なクッキー",enableCookies:"Torusにアクセスするには、ブラウザの設定でCookieを有効にしてください。",clickHere:"詳しくは"}},ko:{embed:{continue:"계속하다",actionRequired:"승인 필요",pendingAction:"팝업에서 요청을 진행하려면 계속을 클릭하십시오.",cookiesRequired:"쿠키 필요",enableCookies:"브라우저 환경 설정에서 쿠키를 활성화하여 Torus에 액세스하십시오.",clickHere:"더 많은 정보"}},zh:{embed:{continue:"继续",actionRequired:"需要授权",pendingAction:"单击继续以在弹出窗口中继续您的请求",cookiesRequired:"必填Cookie",enableCookies:"请在您的浏览器首选项中启用cookie以访问Torus。",clickHere:"更多信息"}}},prodTorusUrl:"",localStorageKey:"torus-".concat(window.location.hostname)},w=n().getLogger("solana-embed");let x=()=>Math.random().toString(36).slice(2),y=async a=>{let b,c;switch(a){case"testing":b="https://solana-testing.tor.us",c="debug";break;case"development":b="http://localhost:8080",c="debug";break;default:b="https://solana.tor.us",c="error"}return{torusUrl:b,logLevel:c}},z={height:660,width:375},A={height:740,width:1315},B={height:600,width:400};function C(a){let{width:b,height:c}=a,d=void 0!==window.screenLeft?window.screenLeft:window.screenX,e=void 0!==window.screenTop?window.screenTop:window.screenY,f=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width,g=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height,h="titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=".concat(c/1,",width=").concat(b/1,",top=").concat(Math.abs((g-c)/2/1+e),",left=").concat(Math.abs((f-b)/2/1+d));return h}class D extends h.Ue{constructor(a,b){let{maxEventListeners:c=100,jsonRpcStreamName:e="provider"}=b;if(super(),(0,d.Z)(this,"isTorus",void 0),(0,d.Z)(this,"_rpcEngine",void 0),(0,d.Z)(this,"jsonRpcConnectionEvents",void 0),(0,d.Z)(this,"_state",void 0),!(0,j.duplex)(a))throw Error(r.errors.invalidDuplexStream());this.isTorus=!0,this.setMaxListeners(c),this._handleConnect=this._handleConnect.bind(this),this._handleDisconnect=this._handleDisconnect.bind(this),this._handleStreamDisconnect=this._handleStreamDisconnect.bind(this),this._rpcRequest=this._rpcRequest.bind(this),this._initializeState=this._initializeState.bind(this),this.request=this.request.bind(this),this.sendAsync=this.sendAsync.bind(this);let g=new h.O4;l()(a,g,a,this._handleStreamDisconnect.bind(this,"Torus")),g.ignoreStream("phishing");let k=(0,h.AP)();l()(k.stream,g.createStream(e),k.stream,this._handleStreamDisconnect.bind(this,"Torus RpcProvider"));let m=new h.eI;m.push((0,h.Rq)()),m.push((a,b,c)=>{"string"==typeof a.method&&a.method||(b.error=i.ethErrors.rpc.invalidRequest({message:"The request 'method' must be a non-empty string.",data:a})),c(a=>{let{error:c}=b;return c&&w.error("Torus - RPC Error: ".concat(c.message),c),a()})}),m.push((0,f.yh)({origin:location.origin})),m.push(k.middleware),this._rpcEngine=m,this.jsonRpcConnectionEvents=k.events}async request(a){if(!a||"object"!=typeof a||Array.isArray(a))throw i.ethErrors.rpc.invalidRequest({message:r.errors.invalidRequestArgs(),data:a});let{method:b,params:c}=a;if("string"!=typeof b||0===b.length)throw i.ethErrors.rpc.invalidRequest({message:r.errors.invalidRequestMethod(),data:a});if(void 0!==c&&!Array.isArray(c)&&("object"!=typeof c||null===c))throw i.ethErrors.rpc.invalidRequest({message:r.errors.invalidRequestParams(),data:a});return new Promise((a,d)=>{this._rpcRequest({method:b,params:c},(0,h.nE)(a,d))})}send(a,b){this._rpcRequest(a,b)}sendAsync(a){return new Promise((b,c)=>{this._rpcRequest(a,(0,h.nE)(b,c))})}_handleStreamDisconnect(a,b){var c,d,e;let f;c=a,d=b,e=this,f='Torus: Lost connection to "'.concat(c,'".'),null!=d&&d.stack&&(f+="\n".concat(d.stack)),w.warn(f),e&&e.listenerCount("error")>0&&e.emit("error",f),this._handleDisconnect(!1,b?b.message:void 0)}}let E=function(a,b,c){for(var d=arguments.length,e=Array(d>3?d-3:0),f=3;f<d;f++)e[f-3]=arguments[f];let g=()=>{c(...e),a.removeEventListener(b,g)};a.addEventListener(b,g)};async function F(){return new Promise(a=>{"loading"!==document.readyState?a():E(document,"DOMContentLoaded",a)})}let G=a=>{let b=window.document.createElement("template"),c=a.trim();return b.innerHTML=c,b.content.firstChild};class H extends h.Ue{constructor(a){let{url:b,target:c,features:e}=a;super(),(0,d.Z)(this,"url",void 0),(0,d.Z)(this,"target",void 0),(0,d.Z)(this,"features",void 0),(0,d.Z)(this,"window",void 0),(0,d.Z)(this,"windowTimer",void 0),(0,d.Z)(this,"iClosedWindow",void 0),this.url=b,this.target=c||"_blank",this.features=e||C({height:700,width:1200}),this.window=void 0,this.windowTimer=void 0,this.iClosedWindow=!1,this._setupTimer()}_setupTimer(){this.windowTimer=Number(setInterval(()=>{this.window&&this.window.closed&&(clearInterval(this.windowTimer),this.iClosedWindow||this.emit("close"),this.iClosedWindow=!1,this.window=void 0),void 0===this.window&&clearInterval(this.windowTimer)},500))}open(){var a;return this.window=window.open(this.url.href,this.target,this.features),null!==(a=this.window)&& void 0!==a&&a.focus&&this.window.focus(),Promise.resolve()}close(){this.iClosedWindow=!0,this.window&&this.window.close()}redirect(a){a?window.location.replace(this.url.href):window.location.href=this.url.href}}function I(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}class J extends D{constructor(a,b){let{maxEventListeners:c=100,jsonRpcStreamName:e="provider"}=b;super(a,{maxEventListeners:c,jsonRpcStreamName:e}),(0,d.Z)(this,"embedTranslations",void 0),(0,d.Z)(this,"torusUrl",void 0),(0,d.Z)(this,"dappStorageKey",void 0),(0,d.Z)(this,"windowRefs",void 0),(0,d.Z)(this,"tryWindowHandle",void 0),(0,d.Z)(this,"torusAlertContainer",void 0),(0,d.Z)(this,"torusIframe",void 0),this._state=function(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?I(Object(c),!0).forEach(function(b){(0,d.Z)(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):I(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}({},J._defaultState),this.torusUrl="",this.dappStorageKey="";let g=v.translations[(()=>{let a=window.navigator.language||"en-US",b=a.split("-");return Object.prototype.hasOwnProperty.call(v.translations,b[0])?b[0]:"en"})()];this.embedTranslations=g.embed,this.windowRefs={},this.on("connect",()=>{this._state.isConnected=!0});let h=a=>{let{method:b,params:c}=a;if(b===f.Nb.IFRAME_STATUS){let{isFullScreen:d,rid:e}=c;this._displayIframe({isFull:d,rid:e})}else if(b===f.Nb.CREATE_WINDOW){let{windowId:g,url:h}=c;this._createPopupBlockAlert(g,h)}else if(b===f.Nb.CLOSE_WINDOW)this._handleCloseWindow(c);else if(b===f.Nb.USER_LOGGED_IN){let{currentLoginProvider:i}=c;this._state.isLoggedIn=!0,this._state.currentLoginProvider=i}else b===f.Nb.USER_LOGGED_OUT&&(this._state.isLoggedIn=!1,this._state.currentLoginProvider=null,this._displayIframe())};this.jsonRpcConnectionEvents.on("notification",h)}get isLoggedIn(){return this._state.isLoggedIn}get isIFrameFullScreen(){return this._state.isIFrameFullScreen}isConnected(){return this._state.isConnected}async _initializeState(a){try{let{torusUrl:b,dappStorageKey:c,torusAlertContainer:d,torusIframe:e}=a;this.torusUrl=b,this.dappStorageKey=c,this.torusAlertContainer=d,this.torusIframe=e,this.torusIframe.addEventListener("load",()=>{this._state.isIFrameFullScreen||this._displayIframe()});let{currentLoginProvider:g,isLoggedIn:h}=await this.request({method:f.vU.GET_PROVIDER_STATE,params:[]});this._handleConnect(g,h)}catch(i){w.error("Torus: Failed to get initial state. Please report this bug.",i)}finally{w.info("initialized communication state"),this._state.initialized=!0,this.emit("_initialized")}}_handleWindow(a){let{url:b,target:c,features:d}=arguments.length>1&& void 0!==arguments[1]?arguments[1]:{},e=new URL(b||"".concat(this.torusUrl,"/redirect?windowId=").concat(a));this.dappStorageKey&&(e.hash?e.hash+="&dappStorageKey=".concat(this.dappStorageKey):e.hash="#dappStorageKey=".concat(this.dappStorageKey));let g=new H({url:e,target:c,features:d});if(g.open(),!g.window){this._createPopupBlockAlert(a,e.href);return}this.windowRefs[a]=g,this.request({method:f.vU.OPENED_WINDOW,params:{windowId:a}}),g.once("close",()=>{delete this.windowRefs[a],this.request({method:f.vU.CLOSED_WINDOW,params:{windowId:a}})})}_displayIframe(){let{isFull:a=!1,rid:b=""}=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{},c={};if(a)c.display="block",c.width="100%",c.height="100%",c.top="0px",c.right="0px",c.left="0px",c.bottom="0px";else switch(c.display=this._state.torusWidgetVisibility?"block":"none",c.height="70px",c.width="70px",this._state.buttonPosition){case t.TOP_LEFT:c.top="0px",c.left="0px",c.right="auto",c.bottom="auto";break;case t.TOP_RIGHT:c.top="0px",c.right="0px",c.left="auto",c.bottom="auto";break;case t.BOTTOM_RIGHT:c.bottom="0px",c.right="0px",c.top="auto",c.left="auto";break;case t.BOTTOM_LEFT:default:c.bottom="0px",c.left="0px",c.top="auto",c.right="auto"}Object.assign(this.torusIframe.style,c),this._state.isIFrameFullScreen=a,this.request({method:f.vU.IFRAME_STATUS,params:{isIFrameFullScreen:a,rid:b}})}hideTorusButton(){this._state.torusWidgetVisibility=!1,this._displayIframe()}showTorusButton(){this._state.torusWidgetVisibility=!0,this._displayIframe()}_rpcRequest(a,b){let c=a;Array.isArray(c)||c.jsonrpc||(c.jsonrpc="2.0"),this.tryWindowHandle(c,b)}_handleConnect(a,b){this._state.isConnected||(this._state.isConnected=!0,this.emit("connect",{currentLoginProvider:a,isLoggedIn:b}),w.debug(r.info.connected(a)))}_handleDisconnect(a,b){if(this._state.isConnected|| !this._state.isPermanentlyDisconnected&&!a){this._state.isConnected=!1;let c;a?(c=new i.EthereumRpcError(1013,b||r.errors.disconnected()),w.debug(c)):(c=new i.EthereumRpcError(1011,b||r.errors.permanentlyDisconnected()),w.error(c),this._state.currentLoginProvider=null,this._state.isLoggedIn=!1,this._state.torusWidgetVisibility=!1,this._state.isIFrameFullScreen=!1,this._state.isPermanentlyDisconnected=!0),this.emit("disconnect",c)}}_handleCloseWindow(a){let{windowId:b}=a;this.windowRefs[b]&&(this.windowRefs[b].close(),delete this.windowRefs[b])}async _createPopupBlockAlert(a,b){let c=this.getLogoUrl(),d=G('<div id="torusAlert" class="torus-alert--v2">'+'<div id="torusAlert__logo"><img src="'.concat(c,'" /></div>')+"<div>"+'<h1 id="torusAlert__title">'.concat(this.embedTranslations.actionRequired,"</h1>")+'<p id="torusAlert__desc">'.concat(this.embedTranslations.pendingAction,"</p>")+"</div></div>"),e=G('<div><a id="torusAlert__btn">'.concat(this.embedTranslations.continue,"</a></div>")),f=G('<div id="torusAlert__btn-container"></div>');f.appendChild(e),d.appendChild(f),await F(),(()=>{this.torusAlertContainer.appendChild(d)})(),(()=>{e.addEventListener("click",()=>{this._handleWindow(a,{url:b,target:"_blank",features:C(B)}),d.remove(),0===this.torusAlertContainer.children.length&&(this.torusAlertContainer.style.display="none")})})(),this.torusAlertContainer.style.display="block"}getLogoUrl(){let a="".concat(this.torusUrl,"/images/torus_icon-blue.svg");return a}}function K(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}(0,d.Z)(J,"_defaultState",{buttonPosition:"bottom-left",currentLoginProvider:null,isIFrameFullScreen:!1,hasEmittedConnection:!1,torusWidgetVisibility:!1,initialized:!1,isLoggedIn:!1,isPermanentlyDisconnected:!1,isConnected:!1});class L extends D{constructor(a,b){let{maxEventListeners:c=100,jsonRpcStreamName:e="provider"}=b;super(a,{maxEventListeners:c,jsonRpcStreamName:e}),(0,d.Z)(this,"chainId",void 0),(0,d.Z)(this,"selectedAddress",void 0),(0,d.Z)(this,"tryWindowHandle",void 0),this._state=function(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?K(Object(c),!0).forEach(function(b){(0,d.Z)(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):K(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}({},L._defaultState),this.selectedAddress=null,this.chainId=null,this._handleAccountsChanged=this._handleAccountsChanged.bind(this),this._handleChainChanged=this._handleChainChanged.bind(this),this._handleUnlockStateChanged=this._handleUnlockStateChanged.bind(this),this.on("connect",()=>{this._state.isConnected=!0});let g=a=>{let{method:b,params:c}=a;b===f.zK.ACCOUNTS_CHANGED?this._handleAccountsChanged(c):b===f.zK.UNLOCK_STATE_CHANGED?this._handleUnlockStateChanged(c):b===f.zK.CHAIN_CHANGED&&this._handleChainChanged(c)};this.jsonRpcConnectionEvents.on("notification",g)}isConnected(){return this._state.isConnected}async _initializeState(){try{let{accounts:a,chainId:b,isUnlocked:c}=await this.request({method:f.GA.GET_PROVIDER_STATE,params:[]});this.emit("connect",{chainId:b}),this._handleChainChanged({chainId:b}),this._handleUnlockStateChanged({accounts:a,isUnlocked:c}),this._handleAccountsChanged(a)}catch(d){w.error("Torus: Failed to get initial state. Please report this bug.",d)}finally{w.info("initialized provider state"),this._state.initialized=!0,this.emit("_initialized")}}_rpcRequest(a,b){let c=arguments.length>2&& void 0!==arguments[2]&&arguments[2],d=b,e=a;if(!Array.isArray(e)){if(e.jsonrpc||(e.jsonrpc="2.0"),"solana_accounts"===e.method||"solana_requestAccounts"===e.method)d=(a,d)=>{this._handleAccountsChanged(d.result||[],"solana_accounts"===e.method,c),b(a,d)};else if("wallet_getProviderState"===e.method){this._rpcEngine.handle(a,d);return}}this.tryWindowHandle(e,d)}_handleConnect(a){this._state.isConnected||(this._state.isConnected=!0,this.emit("connect",{chainId:a}),w.debug(r.info.connected(a)))}_handleDisconnect(a,b){if(this._state.isConnected|| !this._state.isPermanentlyDisconnected&&!a){this._state.isConnected=!1;let c;a?(c=new i.EthereumRpcError(1013,b||r.errors.disconnected()),w.debug(c)):(c=new i.EthereumRpcError(1011,b||r.errors.permanentlyDisconnected()),w.error(c),this.chainId=null,this._state.accounts=null,this.selectedAddress=null,this._state.isUnlocked=!1,this._state.isPermanentlyDisconnected=!0),this.emit("disconnect",c)}}_handleAccountsChanged(a){let b=arguments.length>1&& void 0!==arguments[1]&&arguments[1],c=arguments.length>2&& void 0!==arguments[2]&&arguments[2],d=a;for(let e of(Array.isArray(d)||(w.error("Torus: Received non-array accounts parameter. Please report this bug.",d),d=[]),a))if("string"!=typeof e){w.error("Torus: Received non-string account. Please report this bug.",a),d=[];break}p()(this._state.accounts,d)||(b&&Array.isArray(this._state.accounts)&&this._state.accounts.length>0&&!c&&w.error('Torus: "solana_accounts" unexpectedly updated accounts. Please report this bug.',d),this._state.accounts=d,this.emit("accountsChanged",d)),this.selectedAddress!==d[0]&&(this.selectedAddress=d[0]||null)}_handleChainChanged(){let{chainId:a}=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{};if(!a){w.error("Torus: Received invalid network parameters. Please report this bug.",{chainId:a});return}"loading"===a?this._handleDisconnect(!0):(this._handleConnect(a),a!==this.chainId&&(this.chainId=a,this._state.initialized&&this.emit("chainChanged",this.chainId)))}_handleUnlockStateChanged(){let{accounts:a,isUnlocked:b}=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{};if("boolean"!=typeof b){w.error("Torus: Received invalid isUnlocked parameter. Please report this bug.",{isUnlocked:b});return}b!==this._state.isUnlocked&&(this._state.isUnlocked=b,this._handleAccountsChanged(a||[]))}}function M(a){return new Promise((b,c)=>{try{let d=document.createElement("img");d.onload=()=>b(!0),d.onerror=()=>b(!1),d.src=a}catch(e){c(e)}})}(0,d.Z)(L,"_defaultState",{accounts:null,isConnected:!1,isUnlocked:!1,initialized:!1,isPermanentlyDisconnected:!1,hasEmittedConnection:!1});let N=a=>{let{document:b}=a,c=b.querySelector('head > meta[property="og:site_name"]');if(c)return c.content;let d=b.querySelector('head > meta[name="title"]');return d?d.content:b.title&&b.title.length>0?b.title:a.location.hostname};async function O(a){try{let{document:b}=a,c=b.querySelector('head > link[rel="shortcut icon"]');if(c&&await M(c.href)||(c=Array.from(b.querySelectorAll('head > link[rel="icon"]')).find(a=>Boolean(a.href)))&&await M(c.href))return c.href;return""}catch(d){return""}}let P=async()=>({name:N(window),icon:await O(window)});function Q(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function R(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?Q(Object(c),!0).forEach(function(b){(0,d.Z)(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):Q(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}let{version:S}=c(27384),T=["send_transaction","sign_transaction","sign_all_transactions","sign_message","connect"],U=[f.vU.SET_PROVIDER],V=function(a){let b;try{b=window[a];let c="__storage_test__";return b.setItem(c,c),b.removeItem(c),!0}catch(d){return d&&(22===d.code||1014===d.code||"QuotaExceededError"===d.name||"NS_ERROR_DOM_QUOTA_REACHED"===d.name)&&b&&0!==b.length}}("localStorage");!async function(){try{if("undefined"==typeof document)return;let a=document.createElement("link"),{torusUrl:b}=await y("production");a.href="".concat(b,"/frame"),a.crossOrigin="anonymous",a.type="text/html",a.rel="prefetch",a.relList&&a.relList.supports&&a.relList.supports("prefetch")&&document.head.appendChild(a)}catch(c){w.warn(c)}}();class W{constructor(){let{modalZIndex:a=99999}=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{};(0,d.Z)(this,"isInitialized",void 0),(0,d.Z)(this,"torusAlert",void 0),(0,d.Z)(this,"modalZIndex",void 0),(0,d.Z)(this,"alertZIndex",void 0),(0,d.Z)(this,"requestedLoginProvider",void 0),(0,d.Z)(this,"provider",void 0),(0,d.Z)(this,"communicationProvider",void 0),(0,d.Z)(this,"dappStorageKey",void 0),(0,d.Z)(this,"torusAlertContainer",void 0),(0,d.Z)(this,"torusUrl",void 0),(0,d.Z)(this,"torusIframe",void 0),(0,d.Z)(this,"styleLink",void 0),this.torusUrl="",this.isInitialized=!1,this.requestedLoginProvider=null,this.modalZIndex=a,this.alertZIndex=a+1e3,this.dappStorageKey=""}get isLoggedIn(){return!!this.communicationProvider&&this.communicationProvider.isLoggedIn}async init(){let{buildEnv:a=s.PRODUCTION,enableLogging:b=!1,network:c,showTorusButton:d=!1,useLocalStorage:e=!1,buttonPosition:f=t.BOTTOM_LEFT,apiKey:h="torus-default",extraParams:i={}}=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{};if(this.isInitialized)throw Error("Already initialized");(0,g.ut)(h);let{torusUrl:j,logLevel:k}=await y(a);w.enableAll(),w.info(j,"url loaded"),w.info("Solana Embed Version :".concat(S)),this.torusUrl=j,w.setDefaultLevel(k),b?w.enableAll():w.disableAll();let l=this.handleDappStorageKey(e),m=new URL(j);m.pathname.endsWith("/")?m.pathname+="frame":m.pathname+="/frame";let n=new URLSearchParams;l&&n.append("dappStorageKey",l),n.append("origin",window.location.origin),m.hash=n.toString(),this.torusIframe=G('<iframe\n        id="torusIframe"\n        class="torusIframe"\n        src="'.concat(m.href,'"\n        style="display: none; position: fixed; top: 0; right: 0; width: 100%;\n        height: 100%; border: none; border-radius: 0; z-index: ').concat(this.modalZIndex.toString(),'"\n      ></iframe>')),this.torusAlertContainer=G('<div id="torusAlertContainer" style="display:none; z-index: '.concat(this.alertZIndex.toString(),'"></div>')),this.styleLink=G('<link href="'.concat(j,'/css/widget.css" rel="stylesheet" type="text/css">'));let o=async()=>new Promise((a,b)=>{try{window.document.head.appendChild(this.styleLink),window.document.body.appendChild(this.torusIframe),window.document.body.appendChild(this.torusAlertContainer),this.torusIframe.addEventListener("load",async()=>{let b=await P();this.torusIframe.contentWindow.postMessage({buttonPosition:f,apiKey:h,network:c,dappMetadata:b,extraParams:i},m.origin),await this._setupWeb3({torusUrl:j}),d?this.showTorusButton():this.hideTorusButton(),this.isInitialized=!0,window.torus=this,a()})}catch(e){b(e)}});await F(),await o()}async login(){let a=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{};if(!this.isInitialized)throw Error("Call init() first");try{this.requestedLoginProvider=a.loginProvider||null,this.requestedLoginProvider||this.communicationProvider._displayIframe({isFull:!0});let b=await new Promise((b,c)=>{this.provider._rpcRequest({method:"solana_requestAccounts",params:[this.requestedLoginProvider,a.login_hint]},(0,h.nE)(b,c))});if(Array.isArray(b)&&b.length>0)return b;throw Error("Login failed")}catch(c){throw w.error("login failed",c),c}finally{this.communicationProvider.isIFrameFullScreen&&this.communicationProvider._displayIframe()}}async loginWithPrivateKey(a){if(!this.isInitialized)throw Error("Call init() first");let{privateKey:b,userInfo:c}=a,{success:d}=await this.communicationProvider.request({method:"login_with_private_key",params:{privateKey:b,userInfo:c}});if(!d)throw Error("Login Failed")}async logout(){if(!this.communicationProvider.isLoggedIn)throw Error("Not logged in");await this.communicationProvider.request({method:f.vU.LOGOUT,params:[]}),this.requestedLoginProvider=null}async cleanUp(){this.communicationProvider.isLoggedIn&&await this.logout(),this.clearInit()}clearInit(){function a(a){return a instanceof Element||a instanceof Document}a(this.styleLink)&&window.document.body.contains(this.styleLink)&&(this.styleLink.remove(),this.styleLink=void 0),a(this.torusIframe)&&window.document.body.contains(this.torusIframe)&&(this.torusIframe.remove(),this.torusIframe=void 0),a(this.torusAlertContainer)&&window.document.body.contains(this.torusAlertContainer)&&(this.torusAlert=void 0,this.torusAlertContainer.remove(),this.torusAlertContainer=void 0),this.isInitialized=!1}hideTorusButton(){this.communicationProvider.hideTorusButton()}showTorusButton(){this.communicationProvider.showTorusButton()}async setProvider(a){await this.communicationProvider.request({method:f.vU.SET_PROVIDER,params:R({},a)})}async showWallet(a){let b=arguments.length>1&& void 0!==arguments[1]?arguments[1]:{},c=await this.communicationProvider.request({method:f.vU.WALLET_INSTANCE_ID,params:[]}),d=a?"/".concat(a):"",e=new URL("".concat(this.torusUrl,"/wallet").concat(d));e.searchParams.append("instanceId",c),Object.keys(b).forEach(a=>{e.searchParams.append(a,b[a])}),this.dappStorageKey&&(e.hash="#dappStorageKey=".concat(this.dappStorageKey));let g=new H({url:e,features:C(A)});g.open()}async getUserInfo(){let a=await this.communicationProvider.request({method:f.vU.USER_INFO,params:[]});return a}async initiateTopup(a,b){if(!this.isInitialized)throw Error("Torus is not initialized");let c=x();this.communicationProvider._handleWindow(c);let d=await this.communicationProvider.request({method:f.vU.TOPUP,params:{provider:a,params:b,windowId:c}});return d}async getAccounts(){let a=await this.provider.request({method:"getAccounts",params:[]});return a}async sendTransaction(a){let b=await this.provider.request({method:"send_transaction",params:{message:a.serialize({requireAllSignatures:!1}).toString("hex")}});return b}async signTransaction(a){let b=await this.provider.request({method:"sign_transaction",params:{message:a.serializeMessage().toString("hex"),messageOnly:!0}}),c=JSON.parse(b),d={publicKey:new e.nh(c.publicKey),signature:q.from(c.signature,"hex")};return a.addSignature(d.publicKey,d.signature),a}async signAllTransactions(a){let b=a.map(a=>a.serializeMessage().toString("hex")),c=await this.provider.request({method:"sign_all_transactions",params:{message:b,messageOnly:!0}}),d=c.map(a=>{let b=JSON.parse(a);return{publicKey:new e.nh(b.publicKey),signature:q.from(b.signature,"hex")}});return a.forEach((a,b)=>(a.addSignature(d[b].publicKey,d[b].signature),a)),a}async signMessage(a){let b=await this.provider.request({method:"sign_message",params:{data:a}});return b}async getGaslessPublicKey(){let a=await this.provider.request({method:"get_gasless_public_key",params:[]});return a}handleDappStorageKey(a){let b="";if(V&&a){let c=window.localStorage.getItem(v.localStorageKey);if(c)b=c;else{let d="torus-app-".concat(x());window.localStorage.setItem(v.localStorageKey,d),b=d}}return this.dappStorageKey=b,b}async _setupWeb3(a){w.info("setupWeb3 running");let b=new h.XR({name:"embed_torus",target:"iframe_torus",targetWindow:this.torusIframe.contentWindow}),c=new h.XR({name:"embed_communication",target:"iframe_communication",targetWindow:this.torusIframe.contentWindow}),d=new L(b,{}),e=new J(c,{});d.tryWindowHandle=(a,b)=>{let c=a;if(!Array.isArray(c)&&T.includes(c.method)){if(!this.communicationProvider.isLoggedIn)throw Error("User Not Logged In");let f=x();e._handleWindow(f,{target:"_blank",features:C(B)}),c.windowId=f}d._rpcEngine.handle(c,b)},e.tryWindowHandle=(a,b)=>{let c=a;if(!Array.isArray(c)&&U.includes(c.method)){let d=x();e._handleWindow(d,{target:"_blank",features:C(z)}),c.params.windowId=d}e._rpcEngine.handle(c,b)};let f=a=>{let b=d[a],c=this;d[a]=function(a,d){let{method:e,params:f=[]}=a;if("solana_requestAccounts"===e){if(!d)return c.login({loginProvider:f[0]});c.login({loginProvider:f[0]}).then(a=>d(null,a)).catch(a=>d(a))}return b.apply(this,[a,d])}};f("request"),f("sendAsync"),f("send");let g=new Proxy(d,{deleteProperty:()=>!0}),i=new Proxy(e,{deleteProperty:()=>!0});this.provider=g,this.communicationProvider=i,await Promise.all([d._initializeState(),e._initializeState(R(R({},a),{},{dappStorageKey:this.dappStorageKey,torusAlertContainer:this.torusAlertContainer,torusIframe:this.torusIframe}))]),w.debug("Torus - injected provider")}}var X=c(45624),Y=c(1482),Z=c(44445);function $(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?$(Object(c),!0).forEach(function(b){(0,d.Z)(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):$(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}class aa extends Y.v{constructor(){let a=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{};super(),(0,d.Z)(this,"name",X.rW.TORUS_SOLANA),(0,d.Z)(this,"adapterNamespace",X.yk.SOLANA),(0,d.Z)(this,"currentChainNamespace",X.EN.SOLANA),(0,d.Z)(this,"type",X.hN.EXTERNAL),(0,d.Z)(this,"status",X.MP.NOT_READY),(0,d.Z)(this,"torusInstance",null),(0,d.Z)(this,"torusWalletOptions",void 0),(0,d.Z)(this,"initParams",void 0),(0,d.Z)(this,"loginSettings",{}),(0,d.Z)(this,"solanaProvider",null),(0,d.Z)(this,"rehydrated",!1),this.torusWalletOptions=a.adapterSettings||{},this.initParams=a.initParams||{},this.loginSettings=a.loginSettings||{},this.chainConfig=a.chainConfig||null,this.sessionTime=a.sessionTime||86400}get provider(){if(this.status===X.MP.CONNECTED&&this.solanaProvider){var a;return(null===(a=this.solanaProvider)|| void 0===a?void 0:a.provider)||null}return null}set provider(a){throw Error("Not implemented")}async init(a){super.checkInitializationRequirements();let b;if(this.chainConfig){let{chainId:c,blockExplorer:d,displayName:e,rpcTarget:f,ticker:g,tickerName:h}=this.chainConfig;b={chainId:c,rpcTarget:f,blockExplorerUrl:d,displayName:e,tickerName:h,ticker:g,logo:""}}else{this.chainConfig=(0,X.h2)(X.EN.SOLANA,"0x1");let{blockExplorer:i,displayName:j,ticker:k,tickerName:l,rpcTarget:m,chainId:n}=this.chainConfig;b={chainId:n,rpcTarget:m,blockExplorerUrl:i,displayName:j,ticker:k,tickerName:l,logo:""}}this.torusInstance=new W(this.torusWalletOptions),X.cM.debug("initializing torus solana adapter init"),await this.torusInstance.init(_(_({showTorusButton:!1},this.initParams),{},{network:b})),this.solanaProvider=new Z.TorusInjectedProvider({config:{chainConfig:this.chainConfig}}),this.status=X.MP.READY,this.emit(X.n2.READY,X.rW.TORUS_SOLANA);try{X.cM.debug("initializing torus solana adapter"),a.autoConnect&&(this.rehydrated=!0,await this.connect())}catch(o){X.cM.error("Failed to connect with cached torus solana provider",o),this.emit(X.n2.ERRORED,o)}}async connect(){if(super.checkConnectionRequirements(),!this.torusInstance||!this.solanaProvider)throw X.Ty.notReady("Torus wallet is not initialized");this.status=X.MP.CONNECTING,this.emit(X.n2.CONNECTING,{adapter:X.rW.TORUS_SOLANA});try{await this.torusInstance.login(this.loginSettings);try{let a=this.torusInstance.provider;a.sendTransaction=this.torusInstance.sendTransaction.bind(this.torusInstance),a.signAllTransactions=this.torusInstance.signAllTransactions.bind(this.torusInstance),a.signMessage=this.torusInstance.signMessage.bind(this.torusInstance),a.signTransaction=this.torusInstance.signTransaction.bind(this.torusInstance),await this.solanaProvider.setupProvider(a)}catch(b){if(b instanceof X.up&&5010===b.code){let{chainId:c,blockExplorer:d,displayName:e,rpcTarget:f,ticker:g,tickerName:h}=this.chainConfig,i={chainId:c,rpcTarget:f,blockExplorerUrl:d,displayName:e,tickerName:h,ticker:g,logo:""};await this.torusInstance.setProvider(i)}else throw b}return this.status=X.MP.CONNECTED,this.torusInstance.showTorusButton(),this.emit(X.MP.CONNECTED,{adapter:X.rW.TORUS_SOLANA,reconnected:this.rehydrated}),this.provider}catch(j){throw this.status=X.MP.READY,this.rehydrated=!1,this.emit(X.n2.ERRORED,j),X.RM.connectionError("Failed to login with torus solana wallet")}}async disconnect(){let a=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{cleanup:!1};if(!this.torusInstance)throw X.Ty.notReady("Torus wallet is not initialized");await super.disconnect(),await this.torusInstance.logout(),a.cleanup?(this.status=X.MP.NOT_READY,this.torusInstance=null,this.solanaProvider=null):this.status=X.MP.READY,this.emit(X.n2.DISCONNECTED)}async getUserInfo(){if(this.status!==X.MP.CONNECTED)throw X.RM.notConnectedError("Not connected with wallet");if(!this.torusInstance)throw X.Ty.notReady("Torus wallet is not initialized");let a=await this.torusInstance.getUserInfo();return a}setAdapterSettings(a){this.status!==X.MP.READY&&null!=a&&a.sessionTime&&(this.sessionTime=a.sessionTime)}}},64063:function(a){"use strict";a.exports=function a(b,c){if(b===c)return!0;if(b&&c&&"object"==typeof b&&"object"==typeof c){if(b.constructor!==c.constructor)return!1;if(Array.isArray(b)){if((d=b.length)!=c.length)return!1;for(e=d;0!=e--;)if(!a(b[e],c[e]))return!1;return!0}if(b.constructor===RegExp)return b.source===c.source&&b.flags===c.flags;if(b.valueOf!==Object.prototype.valueOf)return b.valueOf()===c.valueOf();if(b.toString!==Object.prototype.toString)return b.toString()===c.toString();if((d=(f=Object.keys(b)).length)!==Object.keys(c).length)return!1;for(e=d;0!=e--;)if(!Object.prototype.hasOwnProperty.call(c,f[e]))return!1;for(e=d;0!=e--;){var d,e,f,g=f[e];if(!a(b[g],c[g]))return!1}return!0}return b!=b&&c!=c}},24970:function(a){"use strict";let b=a=>null!==a&&"object"==typeof a&&"function"==typeof a.pipe;b.writable=a=>b(a)&& !1!==a.writable&&"function"==typeof a._write&&"object"==typeof a._writableState,b.readable=a=>b(a)&& !1!==a.readable&&"function"==typeof a._read&&"object"==typeof a._readableState,b.duplex=a=>b.writable(a)&&b.readable(a),b.transform=a=>b.duplex(a)&&"function"==typeof a._transform,a.exports=b},27384:function(a){"use strict";a.exports=JSON.parse('{"name":"@toruslabs/solana-embed","version":"0.2.2","description":"Embed script for solana blockchain","main":"dist/solanaEmbed.cjs.js","module":"dist/solanaEmbed.esm.js","unpkg":"dist/solanaEmbed.umd.min.js","jsdelivr":"dist/solanaEmbed.umd.min.js","types":"dist/types/index.d.ts","files":["dist","src"],"scripts":{"start":"torus-scripts start","build":"torus-scripts build","build:test":"cross-env NODE_ENV=testing torus-scripts build","release":"torus-scripts release","prepack":"npm run build","lint:ts":"eslint --fix \'src/**/*.ts\'","prepare":"husky install"},"repository":{"type":"git","url":"git+https://github.com/torusresearch/solana-embed.git"},"dependencies":{"@solana/web3.js":"^1.36.0","@toruslabs/base-controllers":"^2.0.0","@toruslabs/http-helpers":"^3.0.0","@toruslabs/openlogin-jrpc":"^2.0.0","eth-rpc-errors":"^4.0.3","fast-deep-equal":"^3.1.3","is-stream":"^2.0.0","lodash-es":"^4.17.21","loglevel":"^1.8.0","pump":"^3.0.0"},"peerDependencies":{"@babel/runtime":"7.x"},"devDependencies":{"@babel/register":"^7.17.7","@commitlint/cli":"^16.2.1","@commitlint/config-conventional":"^16.2.1","@commitlint/is-ignored":"^16.2.1","@toruslabs/eslint-config-typescript":"^1.0.1","@toruslabs/torus-scripts":"^1.0.3","@babel/runtime":"^7.18.0","@types/bs58":"^4.0.1","@types/node":"^17.0.35","@types/once":"^1.4.0","@types/pump":"^1.1.1","@types/readable-stream":"^2.3.13","@typescript-eslint/eslint-plugin":"^5.25.0","@typescript-eslint/parser":"^5.25.0","cross-env":"^7.0.3","eslint":"^8.15.0","eslint-plugin-import":"^2.26.0","eslint-plugin-mocha":"^10.0.4","eslint-plugin-n":"^15.2.0","eslint-plugin-prettier":"^4.0.0","eslint-plugin-promise":"^6.0.0","eslint-plugin-simple-import-sort":"^7.0.0","eslint-plugin-tsdoc":"^0.2.16","husky":"^8.0.1","lint-staged":"^12.4.1","mocha":"^10.0.0","prettier":"^2.6.2","puppeteer":"^14.1.1","rimraf":"^3.0.2","ts-node":"^10.7.0","typescript":"^4.6.4"},"mocha":{"timeout":0},"keywords":["torus","wallet","Solana","embed","login","OAuth","crypto"],"author":"Torus Labs","license":"ISC","bugs":{"url":"https://github.com/torusresearch/solana-embed/issues"},"homepage":"https://github.com/torusresearch/solana-embed#readme","lint-staged":{"!(*d).{js,ts}":["eslint --cache --fix","prettier --write"],"*.{json, md}":["prettier --write"]},"engines":{"node":">=14.17.0","npm":">=6.x"}}')}}])